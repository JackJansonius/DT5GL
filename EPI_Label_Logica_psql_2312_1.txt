

PostgreSQL_database: "rivm_rvp_v5"

# Inbouw extra wensen:
# Marge inbouwen van +- 7 dagen voor de start of einddatum 
# Voor alle 3e A-prikken pas na 1-10-2021 voor prod = com en mod (notitie in mail) 		
# Nieuwe cohorten 6mnd-5jaar en 5jaar-12jaar (was 0-12jaar), naast 12-18 en 18+. 
# 6mnd-5jaar: alleen speciaal vaccin van COM gebruikt; afkorting hier: COM_KIDS. 
#             afwijkend interval tussen de 3 basisprikken: interval tussen vaccinatie 1 en 2 => 3 weken, interval tussen vaccinatie 2 en 3 => 8 weken.
#             geen boosterprikken voor deze groep.
# 5jaar-12jaar: in principe het oude cohort 0-12jaar aanhouden, maar:
#               JANSS en AZ alleen 18+
#               NVXD mag pas vanaf maart 2022 gegeven worden voor 18+. Voor 12-17 jarigen mocht dit 11 oktober 2022  
#               Kinderen van 5 t/m 11 met een medisch hoog risico mochten vanaf 20 december 2021 gevaccineerd worden. 
#               Ook zijn hier herhaalprikken/boosters toegestaan met een COM, bivalent vaccin (afkorting hier: COMBI); (itt. het oude cohort 0-12jaar).

# 26/5/2023 Kleine correcties doorgevoerd: 
# Tabel 3: Er zijn maximaal 4 boosterprikken toegestaan. Dus boosterprik 5 moet op dit moment nog afgekeurd worden.
# Tabel 13: Antwoord op de opmerking: Voor Cohort 5-12 alleen vaccin = "COMBI" goedkeuren, niet vaccin "COM_BA1" en "COM_BA45" (dat zijn de volwassen doses).
# Tabel 14: Janssen mag niet gegeven worden < 18 jaar. Janssen kan toegevoegd worden bij True = Vaccin in ["NVXD", "AZ"] (verwijzing naar onmogelijke startdatum)
# 29/5/2023 Tabellen 16 en 17 voor bepalen 'Basisprik voldoet aan interval' samengevoegd in één tabel wegens foutieve intervalbepaling. 

# 17/7/2023 Kleine correcties doorgevoerd: 
# Tabel 7: Bivalente vaccins (COM_BA1, COM_BA45, MOD_BA1) mogen niet worden gebruikt voor de basisserie voor kinderen onder de 12 jaar
# Tabel 8: COM_BA1 en MOD_BA1 verwijderd (werd nog niet gebruikt voor de basisserie), BA4/5 toegevoegd vanaf 1 juli 2023
# Tabel 9: COM_BA1 en MOD_BA1 verwijderd (werd nog niet gebruikt voor de basisserie), BA4/5 toegevoegd vanaf 1 juli 2023
# Tabel 10: toevoeging COM aan datum laatst, verandering datum MOD (deze wordt al langer niet meer gebruikt)

# 8/8/2023 Kleine correctie doorgevoerd:
# Tabel 7: "COM" => "COMKI": monovalente basisprik voor cohort 5-11jaar, naast "COMBI": bivalente boosterprik voor cohort 5-11jaar.
# Tabel 10: Janssen vanaf 31 juli 2023 niet meer in gebruik (Janssen mocht ook pas vanaf 18 jaar)  

# 17/8/2023 CohortLeeftijd (leeftijd_1e_vaccinatie) vervangen door PrikLeeftijd (leeftijd op uitvoerdatum vaccinatie). 

# 08/09/2023: 
# Toevoegen XBB vaccins van COM (goedkeuren vanaf 02-10-2023) en afkeuren Novavax (expiratiedatum 30-09-2023).  
# Tabel 3: Maximaal 5 BS prikken toestaan (ipv 4).                                     
# Tabel 6: Toevoegen startdatum basisserie COM XBB voor kinderen van 6mdn t/m 4 jaar.  
# Tabel 7: Toevoeging startdatum basisserie COM XBB kinderen 5 t/m 11 jaar.            
# Tabel 8: Toevoeging startdatum basisserie COM XBB (volwassen vaccin bij kinderen van 12 /tm 17 jaar)     
# Tabel 9: toevoeging startdatum basisserie COMS XBB bij 18+                           
# Tabel 10: einddatum basisserie voor de vaccins "COMBI", "COM_BA45", "COM_KIDS", "NVXD" op 01/10/2023 gezet  
# Tabel 13: startdatum herhaalprik kinderen 5 t/m 11 COMKI_XBB (kindervaccin 5 /tm 11 jaar XBB) toegevoegd    
# Tabel 14: startdatum herhaalprik kinderen 12 t/m 17 toegevoegd                       
# Tabel 15: startdatum herhaalprik volwassenen (18+) toegevoegd

# 15/11/2023 Tabel 2a ingevoegd:
# Door andere uitvoerders dan de GGD werden na 1 januari 2022 boostervaccins aangeleverd met label A (=basisvaccinatie);
# deze moeten alsnog als boostervaccinatie worden beoordeeld en gelabeld. 
# Maar alleen als voor 1 januari 2022 al basisvaccinaties zijn geregistreerd.  
# In databaseview prik het attribuut uitvoerder toegevoegd. 

# 11/12/2023: Goedkeuring Novavax XBB voor iedereen vanaf 12 jaar, vanaf uitvoerdatum 11/12/2023, voor basisserie en booster
# Tabel 8, 9, 14, 15 toevoeging "NVXD_XBB"
# Attribute Vaccin: "NVXD_XBB" toegevoegd


# OVERZICHT:
# VolgendeClient
#   'Volgende client aanwezig'
#
# Label
#   'Volgende prik voor client' 
#   'Basisprik voldoet aan cohort'
#       Datum_basis_vroegst
#           PrikLeeftijd
#           Vaccin
#       Datum_basis_laatst
#           PrikLeeftijd
#           Vaccin
#   'Basisprik voldoet aan interval'
#       datum_vorig_basisprik (var)
#   'Boosterprik voldoet aan cohort'
#       Datum_booster_vroegst
#           PrikLeeftijd
#           Vaccin
#   'Boosterprik voldoet aan interval'
#       datum_vorig_basisprik (var)
#       datum_vorig_boosterprik (var)




########################### Database views ###########################

Database_view: client
With_attributes: id
Query:
SELECT client_id
  FROM prikken_0_clt
  where vnr = %s  
With_arguments: client.auto_index


Database_view: prik
With_attributes: 
vaccinatie_id_bron, geboortedatum, client_id, leverancierartikelen_code, uitvoerder, uitvoerdatum, serie, leeftijd_1e_vaccinatie
Query:
  SELECT  rid_fact, geboortedatum, client_id, product_code, agg_type_code, uitvoer_datum, serie, leeftijd_1e_vaccinatie
  FROM prikken_0 
  WHERE client_id = '%s' and vnr = %s and geboortedatum is not null
With_arguments: client.id, prik.auto_index





xxTable 0:
If:                                              | 0| 1| 2|
True = client.auto_index < 60                    | Y| Y| N|
'Volgende client aanwezig'                       | Y| N| -|
Then:
VolgendeClient is Geselecteerd                   | X|  |  |
VolgendeClient is Beeindigd                      |  | X| X|
# .......
# Repeat until: Beeindigd


Table 0:
If:                                              | 0| 1|
'Volgende client aanwezig'                       | Y| N|
Then:
VolgendeClient is Geselecteerd                   | X|  |
VolgendeClient is Beeindigd                      |  | X|
# .......
# Repeat until: Beeindigd


Proposition: 'Volgende client aanwezig'
Obtain_instance_from_database_view: client


rTable 1:  
If:                                              | 0| 1|
'Volgende prik voor client'                      | Y| N|
prik.serie = "Lege aanlevering"                  | Y| -|
Then:                                                
Label is Beeindigd                               |  | X|
Label is AfkeurLeeg                              | X|  |
# .......
# Repeat until: Beeindigd



Table 2a:  
If:                                              | 0| 1| 2| 3| 4| 5| 6| 7| 8| 9|
prik.serie = "A"                                 | Y| Y| Y| Y| Y| Y| Y| Y| Y| N|
Datum_vaccinatie < 20220101                      | Y| N| N| N| N| N| N| N| N| -|
prik.uitvoerder  = "GGD"                         | -| Y| N| N| N| N| N| N| N| -|
aNr = 0                                          | -| -| Y| N| N| N| N| N| N| -|
Datum_eerste_Basisprik >= 20220101               | -| -| -| Y| N| N| N| N| N| -|          
'Boosterprik voldoet aan cohort'                 | -| -| -| -| Y| Y| Y| Y| N| -|      
bNr = 0                                          | -| -| -| -| Y| N| N| N| -| -|
bNr < 5                                          | -| -| -| -| -| Y| Y| N| -| -|
'Boosterprik voldoet aan interval'               | -| -| -| -| -| Y| N| -| -| -|
Then:                                                                           
Label is AfkeurOmlabel                           |  |  |  |  |  |  | X| X| X|  |
Label is BS_01                                   |  |  |  |  | X|  |  |  |  |  |
Label is BS_Volgend                              |  |  |  |  |  | X|  |  |  |  |
# .......
# Door andere uitvoerders dan de GGD werden na 1 januari 2022 boostervaccins aangeleverd met label A.
# Deze alsnog als boostervaccinatie beoordelen en labelen. 
# Maar alleen als voor 1 januari 2022 al basisvaccinaties zijn geregistreerd.  
# AAAA => AABB: Ja, als er basisprikken zijn voor 2022.
# AABA => AABB: Ja, als er basisprikken zijn voor 2022.
# AA => BB; Nee, als geen basisprikken voor 2022; goedkeuren volgens tabel 2b.
# BA => BB; Nee, als geen basisprikken voor 2022; afkeuren volgens tabel 2b.
# Elke kolom zonder conclusie = uitvoeren volgens eerdere functionaliteit (=tabel 2b). 




Table 2b:  
If:                                              | 0| 1| 2| 3| 4| 5| 6|
prik.serie = "A"                                 | Y| Y| Y| Y| Y| Y| N|
'Basisprik voldoet aan cohort'                   | Y| Y| Y| Y| Y| N| -|
aNr = 0                                          | Y| -| N| N| N| -| -|
bNr = 0                                          | Y| N| Y| Y| Y| -| -|
aNr < 3                                          | -| -| Y| Y| N| -| -|
'Basisprik voldoet aan interval'                 | -| -| Y| N| -| -| -|
Then:                                                                  
Label is Afkeur                                  |  | X|  | X| X| X|  |
Label is Basis_1                                 | X|  |  |  |  |  |  |
Label is Basis_Volgend                           |  |  | X|  |  |  |  |
# .......
# aNr = volgnummer basisprik; als 0 dan nog geen basisprikken geregistreerd.
# bNr = volgnummer booster; als 0 dan nog geen boosterprikken geregistreerd.
# Maximaal 3 basisprikken toegestaan; de vierde wordt afgekeurd.

Proposition: 'Volgende prik voor client' 
Obtain_instance_from_database_view: prik


Table 3:  
If:                                              | 0| 1| 2| 3| 4| 5| 6| 7|
True = strcontains(prik.serie, "BS")             | Y| Y| Y| Y| Y| Y| Y| N|
'Boosterprik voldoet aan cohort'                 | Y| Y| Y| Y| Y| Y| N| -|
aNr = 0                                          | Y| -| -| -| N| N| -| -|
bNr = 0                                          | Y| N| N| N| Y| Y| -| -|
bNr < 5                                          | -| Y| Y| N| -| -| -| -|
'Boosterprik voldoet aan interval'               | -| Y| N| -| Y| N| -| -|
Then:                                                                     
Label is Afkeur                                  |  |  | X| X|  | X| X|  |
Label is BS_01                                   | X|  |  |  | X|  |  |  |
Label is BS_Volgend                              |  | X|  |  |  |  |  |  |
# .......
# Maximaal 5 boosterprikken toegestaan; de zesde wordt afgekeurd.


Attribute: True  Type: Integer
Equals: 1

rTable 4:  
If:                                                       | 0|
Datum_vaccinatie >= Datum_basis_vroegst_min_marge         | Y|
Datum_vaccinatie <= Datum_basis_laatst_plus_marge         | Y|
Then:                                                
'Basisprik voldoet aan cohort'                            | X|
# .......
# Datums hier integer; formaat yyyymmdd


# Voor gebruik in condities; formaat yyyymmdd:
Attribute: Datum_vaccinatie                 
Equals:    to_int(prik.uitvoerdatum)  

# Veld in de database; formaat: 'yyyy-mm-dd': 
Attribute: prik.uitvoerdatum                Type: Text
Attribute: prik.geboortedatum               Type: Text

Attribute: PrikLeeftijd   
Equals: leeftijd_op_uitvoerdatum(prik.uitvoerdatum, prik.geboortedatum)


Attribute: Datum_basis_vroegst_min_marge     Type: Integer
Equals:    to_integer(fdatum(integer_naar_fdatuminput(Datum_basis_vroegst)) - fdeltadagen(7))
Attribute: Datum_basis_laatst_plus_marge     Type: Integer
Equals:    to_integer(fdatum(integer_naar_fdatuminput(Datum_basis_laatst)) + fdeltadagen(7))
Attribute: Datum_booster_vroegst_min_marge  Type: Integer
Equals:    to_integer(fdatum(integer_naar_fdatuminput(Datum_booster_vroegst)) - fdeltadagen(7))

# Het aantal margedagen is het getal in: fdeltadagen(7); kan hier aangepast worden. 
# Datum_basis_vroegst is een datum als integer: yyyymmdd (zoals bepaald in verschillende beslissingstabellen). 
# integer_naar_fdatuminput(Datum_basis_vroegst) maakt er tekst van: 'yyyy-mm-dd'.
# fdatum('yyyy-mm-dd') maakt er een intern formaat van, zodat er fdeltadagen bij opgeteld of afgetrokken kunnen worden. 
# to_integer(..) zet de nieuwe datum in dit interne formaat weer om naar een integer in formaat yyyymmdd. 

########### Bepalen Datum Basis Vroegst ######################################

rTable 5:   
If:                                                         | 0|
True = Vaccin in ["COM", "MOD"]                             | Y|
aNr = 2                                                     | Y|
PrikLeeftijd >= 12                                          | Y|                                     
Then:                                                           
Datum_basis_vroegst = 20211001                              | X|
# .......
# Voor alle 3e A-prikken pas na 1-10-2021 voor prod = com en mod
# Overruled cohorten 12-18 en 18+; niet de eerdere cohorten! 


rTable 6: Cohort 0.5-5  
If:                                                         | 0| 1| 2|
PrikLeeftijd < 5                                            | Y| Y| Y|
Vaccin = "COM_KIDS"                                         | Y| N| N|
Vaccin = "COM_KIDS_XBB"                                     | -| Y| N|
Then:                                                              
Datum_basis_vroegst = 20230116                              | X|  |  |
Datum_basis_vroegst = 20231002                              |  | X|  |	    
Datum_basis_vroegst = 20500101                              |  |  | X|
# .......
# Kinderen van 6 maanden t/m 4 jaar mogen ook gevaccineerd worden vanaf 16-01-2023 indien ze tot een risicogroep behoren.
# Er wordt een speciaal vaccin van COM gebruikt in deze groep. 
# 3 doses; interval tussen vaccinatie 1 en 2 => 3 weken (=21 dagen), interval tussen vaccinatie 2 en 3 => 8 weken (=56 dagen). 


rTable 7: Cohort 5-12 
If:                                                         | 0| 1| 2|
PrikLeeftijd < 12                                           | Y| Y| Y|
True = Vaccin in ["COMKI", "MOD", "UNK"]                    | Y| N| N|
Vaccin = "COMKI_XBB"                                        | -| Y| N|
Then:                                                              
Datum_basis_vroegst = 20211220                              | X|  |  |
Datum_basis_vroegst = 20231002                              |  | X|  |
Datum_basis_vroegst = 20500101                              |  |  | X|
# .......
# Kinderen van 5 t/m 11 met een medisch hoog risico mochten vanaf 20 december 2021 gevaccineerd worden.


rTable 8: Cohort 12-18
If:                                                         | 0| 1| 2| 3| 4| 5| 6|
PrikLeeftijd < 18                                           | Y| Y| Y| Y| Y| Y| Y|
True = Vaccin in ["COM", "UNK"]                             | Y| N| N| N| N| N| -|
Vaccin = "MOD"                                              | -| Y| N| N| N| N| -|
Vaccin = "COM_BA45"                                         | -| -| Y| N| N| N| -|
Vaccin = "NVXD"                                             | -| -| -| Y| N| N| -|
Vaccin = "COM_XBB"                                          | -| -| -| -| Y| N| -|
Vaccin = "NVXD_XBB"                                         | -| -| -| -| -| Y| -|
Then:                                                                    
Datum_basis_vroegst = 20210104                              | X|  |  |  |  |  |  |
Datum_basis_vroegst = 20210118                              |  | X|  |  |  |  |  |
Datum_basis_vroegst = 20230701                              |  |  | X|  |  |  |  |
Datum_basis_vroegst = 20221011                              |  |  |  | X|  |  |  |
Datum_basis_vroegst = 20231002                              |  |  |  |  | X|  |  |
Datum_basis_vroegst = 20231211                              |  |  |  |  |  | X|  |
Datum_basis_vroegst = 20500101                              |  |  |  |  |  |  | X|
# .......
# De derde basisprik met "COM" en "MOD" heeft een afwijkende Datum_basis_vroegst; zie tabel 5. 


rTable 9: Cohort 18+
If:                                                         | 0| 1| 2| 3| 4| 5| 6| 7| 8|
PrikLeeftijd >= 18                                          | Y| Y| Y| Y| Y| Y| Y| Y| Y|
True = Vaccin in ["COM", "UNK"]                             | Y| N| N| N| N| N| N| N| -|
Vaccin = "MOD"                                              | -| Y| N| N| N| N| N| N| -|
Vaccin = "COM_BA45"                                         | -| -| Y| N| N| N| N| N| -|
Vaccin = "NVXD"                                             | -| -| -| Y| N| N| N| N| -|
Vaccin = "AZ"                                               | -| -| -| -| Y| N| N| N| -|
Vaccin = "JANSS"                                            | -| -| -| -| -| Y| N| N| -|
Vaccin = "COM_XBB"                                          | -| -| -| -| -| -| Y| N| -|
Vaccin = "NVXD_XBB"                                         | -| -| -| -| -| -| -| Y| -|
Then:                                                                          
Datum_basis_vroegst = 20210104                              | X|  |  |  |  |  |  |  |  |
Datum_basis_vroegst = 20210118                              |  | X|  |  |  |  |  |  |  |
Datum_basis_vroegst = 20230701                              |  |  | X|  |  |  |  |  |  |
Datum_basis_vroegst = 20220314                              |  |  |  | X|  |  |  |  |  |
Datum_basis_vroegst = 20210208                              |  |  |  |  | X|  |  |  |  |
Datum_basis_vroegst = 20210419                              |  |  |  |  |  | X|  |  |  |
Datum_basis_vroegst = 20231002                              |  |  |  |  |  |  | X|  |  |
Datum_basis_vroegst = 20231211                              |  |  |  |  |  |  |  | X|  |
Datum_basis_vroegst = 20500101                              |  |  |  |  |  |  |  |  | X|
# .......
# De derde basisprik met "COM" en "MOD" heeft een afwijkende Datum_basis_vroegst; zie tabel 5. 


########### Bepalen Datum Basis Laatst ######################################

 
rTable 10:   
If:                                                         | 0| 1| 2| 3| 4| 5|
Vaccin = "MOD"                                              | Y| N| N| N| N| N|
Vaccin = "COM"                                              | -| Y| N| N| N| N|	
True = Vaccin in ["COMBI", "COM_BA45", "COM_KIDS", "NVXD"]  | -| -| Y| N| N| N|  
PrikLeeftijd >= 12                                          | -| -| -| Y| -| -|
Vaccin = "AZ"                                               | -| -| -| Y| -| -|
PrikLeeftijd >= 18                                          | -| -| -| -| Y| -|
Vaccin = "JANSS"                                            | -| -| -| -| Y| -|
Then:                                                                 
Datum_basis_laatst = 20230417                               | X|  |  |  |  |  |	
Datum_basis_laatst = 20230701                               |  | X|  |  |  |  |
Datum_basis_laatst = 20231001                               |  |  | X|  |  |  |
Datum_basis_laatst = 20221101                               |  |  |  | X|  |  |
Datum_basis_laatst = 20230731                               |  |  |  |  | X|  |
Datum_basis_laatst = 20500101                               |  |  |  |  |  | X|
# .......



#############################################################################

rTable 11:  
If:                                                         | 0|
Datum_vaccinatie >= Datum_booster_vroegst_min_marge         | Y|
Then:                                                           
'Boosterprik voldoet aan cohort'                            | X|
# .......


########### Bepalen Datum Booster Vroegst ###################################


rTable 12: Cohort 0.5-5  
If:                                                         | 0|
PrikLeeftijd < 5                                            | Y|
Then:                                                           
Datum_booster_vroegst = 20500101                            | X|
# .......
# herhaalprik voor deze groep nog niet mogelijk

rTable 13: Cohort 5-12  
If:                                                         | 0| 1| 2|
PrikLeeftijd < 12                                           | Y| Y| Y|
Vaccin = "COMBI"                                            | Y| N| N|
Vaccin = "COMKI_XBB"                                        | -| Y| N|
Then:                                                           
Datum_booster_vroegst = 20230222                            | X|  |  |
Datum_booster_vroegst = 20231002                            |  | X|  |
Datum_booster_vroegst = 20500101                            |  |  | X|
# .......
# Kinderen van 5 t/m 11 mogen vanaf 20230222 wel een herhaalprik ontvangen (met COM, bivalent)



rTable 14: Cohort 12-18  
If:                                                         | 1| 2| 3| 4| 5| 6|
PrikLeeftijd < 18                                           | Y| Y| Y| Y| Y| Y|
True = Vaccin in ["COM","MOD","UNK"]                        | Y| N| N| N| N| N|
True = Vaccin in ["COM_BA1","COM_BA45","MOD_BA1"]           | -| Y| N| N| N| N|
True = Vaccin in ["NVXD","AZ","JANSS"]                      | -| -| Y| N| N| N|
Vaccin = "COM_XBB"                                          | -| -| -| Y| N| N|
Vaccin = "NVXD_XBB"                                         | -| -| -| -| Y| N|
Then:                                                                 
Datum_booster_vroegst = 20220228                            | X|  |  |  |  |  |
Datum_booster_vroegst = 20220919                            |  | X|  |  |  |  |
Datum_booster_vroegst = 20231002                            |  |  |  | X|  |  |
Datum_booster_vroegst = 20231211                            |  |  |  |  | X|  |
Datum_booster_vroegst = 20500101                            |  |  | X|  |  | X|
# .......


rTable 15: Cohort 18+  
If:                                                         | 0| 1| 2| 3| 4| 5| 6| 7|
PrikLeeftijd >= 18                                          | Y| Y| Y| Y| Y| Y| Y| Y|
True = Vaccin in ["COM","MOD","UNK"]                        | Y| N| N| N| N| N| N| N|
Vaccin = "JANSS"                                            | -| Y| N| N| N| N| N| N|
True = Vaccin in ["COM_BA1","COM_BA45","MOD_BA1"]           | -| -| Y| N| N| N| N| N|
Vaccin = "NVXD"                                             | -| -| -| Y| N| N| N| N|
Vaccin = "AZ"                                               | -| -| -| -| Y| N| N| N|
Vaccin = "COM_XBB"                                          | -| -| -| -| -| Y| N| N|
Vaccin = "NVXD_XBB"                                         | -| -| -| -| -| -| Y| N|
Then:                                                                       
Datum_booster_vroegst = 20211118                            | X|  |  |  |  |  |  |  |
Datum_booster_vroegst = 20220620                            |  | X|  |  |  |  |  |  |
Datum_booster_vroegst = 20220919                            |  |  | X|  |  |  |  |  |
Datum_booster_vroegst = 20221005                            |  |  |  | X|  |  |  |  |
Datum_booster_vroegst = 20231002                            |  |  |  |  |  | X|  |  |
Datum_booster_vroegst = 20231211                            |  |  |  |  |  |  | X|  |
Datum_booster_vroegst = 20500101                            |  |  |  |  | X|  |  | X|
# .......



rTable 16: Bepalen interval voor basisprikken
If:                                                                                    | 0| 1| 2|
PrikLeeftijd < 5                                                                       | Y| Y| N|
aNr = 2                                                                                | Y| N| -|
Datum_vaccinatie >= to_integer(fdatum(datum_vorig_basisprik) + fdeltadagen(56))        | Y| -| -|
Datum_vaccinatie >= to_integer(fdatum(datum_vorig_basisprik) + fdeltadagen(21))        | -| Y| Y|
Then:                                                                                            
'Basisprik voldoet aan interval'                                                       | X| X| X|
# .......
# Standaard interval voor basisprikken: 21 dagen.
# Afwijkend interval voor cohort 0-5jr; 3de basisprik (56 dagen/8 weken).

# datum_vorig_basisprik formaat 'yyyy-mm-dd' (zoals opgeslagen in database)
# nu met to_integer(fdatum(datum_vorig_basisprik) + fdeltadagen(x)) er x dagen bij optellen. 


rTable 17: Bepalen interval voor boosterprikken 
If:                                                                                    | 0| 1|
bNr = 0                                                                                | Y| N|
Datum_vaccinatie >= to_integer(fdatum(datum_vorig_basisprik) + fdeltadagen(60))        | Y| -|
Datum_vaccinatie >= to_integer(fdatum(datum_vorig_boosterprik) + fdeltadagen(60))      | -| Y|
Then:                                                
'Boosterprik voldoet aan interval'                                                     | X| X|
# .......

# De eerste boosterprik wordt vergeleken met de laatste basisprik (die er dus moet zijn). 
# Iedere volgende boosterprik wordt vergeleken met de voorgaande boosterprik



Attribute: datum_vorig_basisprik            Type: Text
Attribute: datum_vorig_boosterprik          Type: Text

Attribute: prik.leverancierartikelen_code   Type: Text

Attribute: omschrijving                     Type: Text
Equals: prik.leverancierartikelen_code


Attribute: Vaccin 
Equals: "AZ"             if omschrijving == 'COVID-19 VACCIN ASTRAZENECA INJVLST'                   else \
        "JANSS"          if omschrijving == 'COVID-19 VACCIN JANSSEN INJVLST 0,5ML'                 else \
        "JANSS"          if omschrijving == 'COVID-19 TRIAL VACCIN JANSSEN INJVLST 0,5ML HB'        else \
        "MOD"            if omschrijving == 'COVID-19 VACCIN MODERNA INJVLST 0,5ML'                 else \
        "MOD"            if omschrijving == 'COVID-19 VACCIN MODERNA INJVLST 0,25ML'                else \
        "MOD_BA1"        if omschrijving == 'COVID-19 VACCIN MODERNA ORIG/OMICRON BA1 INJ 0,5ML'    else \
        "UNK"            if omschrijving == 'COVID-19 VACCIN NIET GESPECIFICEERD INJVLST'           else \
        "COM"            if omschrijving == 'COVID-19 VACCIN PFIZER INJVLST 0,3ML'                  else \
        "COMKI"          if omschrijving == 'COVID-19 VACCIN PFIZER 5-11 JAAR INJVLST 0,2ML'        else \  
        "COMKI_XBB"      if omschrijving == 'COVID-19 VACCIN PFIZER 5-11 JAAR XBB.1.5 INJ 0,3ML'    else \  
        "COMBI"          if omschrijving == 'COVID-19 VACCIN PFIZ 5-11JR OR/OM BA.4-5 INJ 0,2ml'    else \
        "COM_BA1"        if omschrijving == 'COVID-19 VACCIN PFIZER ORIG/OMICRON BA.1 INJ 0,3ML'    else \
        "COM_BA45"       if omschrijving == 'COVID-19 VACCIN PFIZER ORIG/OMICRON B4-5 INJ 0,3ML'    else \
        "COM_XBB"        if omschrijving == 'COVID-19 VACCIN PFIZER XBB.1.5 INJVLST 0,3ML'          else \
        "COM_KIDS"       if omschrijving == 'COVID-19 VACCIN PFIZER 6MND-4 JAAR INJVLST 0,2ML'      else \
        "COM_KIDS_XBB"   if omschrijving == 'COVID-19 VACCIN PFIZ 6MND-4 JAAR XBB.1.5 INJ 0,2ML'    else \
        "NVXD_XBB"       if omschrijving == 'COVID-19 VACCIN NOVAVAX XBB.1.5 INJ 0,5ML'             else \
        "NVXD"           if omschrijving == 'COVID-19 VACCIN NOVAVAX INJVLST 0,5ML'                 else 'xxxx'

# De eerste "COMBI" was "COM"; de tweede toegevoegd: Bivalente herhaalprikken (Boosters) voor cohort 5-11 Jaar. 
# Daarnaast "COM_KIDS" toegevoegd voor cohort 6mmnd-4jaar; Basisprikken. 
# De eerste "COMBI" hernoemt naar "COMKI": de monovalente basisprikken voor voor cohort 5-11 Jaar. 

Attribute: label_basis_volgend    Type: Text
Equals: "Basis" + str(aNr_volgend)

Attribute: label_booster_volgend  Type: Text
Equals: "BS0" + str(bNr_volgend)

Attribute: aNr_volgend            Type: Integer
Equals: aNr + 1

Attribute: bNr_volgend            Type: Integer
Equals: bNr + 1


XX Attribute: prik.rangnummer        Type: Text 

XX Attribute: prik_rangnummer        Type: Text
XX Equals:  "" if prik.rangnummer == "None" else prik.rangnummer 




########################### GoalAttributes ###########################

GoalAttribute: VolgendeClient
Repeat_until: Beeindigd

Case: Beeindigd
Print: "#REM# ===================================================================="
Print: "Beeindigd."
Print: "===================================================================="

Case: Geselecteerd
>>: aNr = 0
>>: bNr = 0
>>: datum_vorig_basisprik = '0000-00-00' 
>>: datum_vorig_boosterprik = '0000-00-00'



GoalAttribute: Label
Repeat_until:  Beeindigd

Case: Beeindigd
Print: "#REM# - Labels client '%s' verwerkt."       client.id  

Case: Afkeur
Print: "%s;Afkeur"   prik.vaccinatie_id_bron       

Case: AfkeurLeeg
Print: "%s;Afkeur"   prik.vaccinatie_id_bron 

Case: AfkeurOmlabel
Print: "%s;Afkeur"   prik.vaccinatie_id_bron  


Case: Basis_1
Print: "%s;Basis1"   prik.vaccinatie_id_bron      
>>: aNr = 1
>>: datum_vorig_basisprik = prik.uitvoerdatum
>>: Datum_eerste_Basisprik = to_int(prik.uitvoerdatum) 


Case: Basis_Volgend
Print: "%s;%s"       prik.vaccinatie_id_bron       label_basis_volgend 
>>: aNr = aNr_volgend
>>: datum_vorig_basisprik = prik.uitvoerdatum


Case: BS_01
Print: "%s;BS01"     prik.vaccinatie_id_bron        
>>: bNr = 1
>>: datum_vorig_boosterprik = prik.uitvoerdatum


Case: BS_Volgend 
Print: "%s;%s"       prik.vaccinatie_id_bron        label_booster_volgend 
>>: bNr = bNr_volgend
>>: datum_vorig_boosterprik = prik.uitvoerdatum


















